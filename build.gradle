// 应用插件
apply plugin: "groovy"
apply plugin: "maven"

// 添加依赖
dependencies {
    compile gradleApi()
    compile localGroovy()
    compile "com.alibaba:fastjson:1.2.44"
}

// 代码仓库
repositories {
    jcenter()
}
// 上传到本地代码库
uploadArchives {
    repositories {
        mavenDeployer {
            repository(url:  "http://192.168.3.7:9527/nexus/content/repositories/releases/") {
//            repository(url:  uri("/home/pqixing/.repo")) {
                authentication(userName: "admin", password: "admin123")
            }
            pom.groupId = "com.dachen.android" // 组名
            pom.artifactId = "modularization" // 插件名
            pom.version = "2.40" // 版本号
        }
    }
}
uploadArchives.doLast {
    def configFile = file("gradle.properties")
    def configs = new Properties()
    configs.load(configFile.newInputStream())
    String[] mvs = configs.getProperty("maven_version").split("\\.")

    configs.setProperty("maven_version", "${mvs[0]}.${mvs[1].toInteger() + 1}")

    configs.store(configFile.newOutputStream(), "")
}